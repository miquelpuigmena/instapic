{
    "swagger": "2.0",
    "info": {
      "description": "Swagger instaPic",
      "version": "1.0.0",
      "title": "Insta Pic",
      "contact": {
        "email": "miquelpuigmena@gmail.com"
      }
    },
    "host": "localhost:3000",
    "basePath": "/api/v1",

    "schemes": [
      "http"
    ],
    "paths": {
      "/register": {
        "post": {
          "tags": [
            "User"
          ],
          "summary": "Persist user in db",
          "description": "Register a new user to service. It creates a username instatnce in db.",
          "operationId": "createUser",
          "consumes": [
            "application/json"
          ],
          "produces": [
            "application/json"
          ],
          "parameters": [
            {
              "in": "body",
              "name": "name",
              "description": "Username identifying user",
              "required": true,
              "schema": {
                "type": "object",
                "properties": {
                    "name": {
                        "type": "string",
                        "example": "reap"
                    }
                }
              }
            }
          ],
          "responses": {
            "200": {
                "message": "User 'reap' registered",
                "description": "The session ID is returned in a cookie named `connect.sid`. You need to include this cookie when logging in.",
                "headers": {
                    "Set-Cookie": {
                        "schema": {
                            "type": "string",
                            "example": "connect.sid=s%3AMhN68yf89hkM-1vNJWaLrbfI8fkk9tvH.XD2AhLu2mzOyi0JHQemDEXfy0DQ0Nqh%2BTMl%2BRySuVTs; Path=/; Expires=Fri, 20 Nov 2020 15:24:50 GMT; HttpOnly"
                        }
                    }
                }
            },
            "400": {
              "message": "Malformed username"
            },
            "500": {
                "message": "Internal error"
            }
          }
        }
      },
      "/login": {
        "post": {
            "tags": [
              "User"
            ],
            "summary": "Logs user to app",
            "description": "Login a new user to service. It binds an existing user to a cookie and sends back cookie to client.",
            "operationId": "loginUser",
            "consumes": [
              "application/json"
            ],
            "produces": [
              "application/json"
            ],
            "parameters": [
              {
                "in": "body",
                "name": "name",
                "description": "Username identifying user",
                "required": true,
                "schema": {
                  "type": "object",
                  "properties": {
                      "name": {
                          "type": "string"
                      }
                  }
                }
              }
            ],
            "responses": {
              "200": {
                  "message": "Login of 'reap' successful"
              },
              "400": {
                "message": "Malformed username"
              },
              "500": {
                  "message": "Internal error"
              }
            }
          }
      },
      "/restricted": {
        "get": {
          "tags": [
            "user"
          ],
          "summary": "Return message if auth OK",
          "description": "For testing purposes. Return message if user is logged in.",
          "operationId": "restricted",
          "produces": [
            "application/json"
          ],
          "consumes": [
            "application/json"
          ],
          "parameters": [],
          "responses": {
            "200": {
              "message": "Login of 'reap' successful"
            },
            "401": {
              "message": "Unauthorized user"
            }
          }
        }
      },
      "/upload": {
        "post": {
          "summary": "Uploads to server",
          "description": "Uploads an image and description to server if user is logged in. Checks size of file. Checks that mime type of request is either jpg or png. Checks that magic numbers of file are of jpg or png. If all correct, store file in disk and persist post in db.",
          "operationId": "getUserByName",
          "produces": [
            "application/json"
          ],
          "consumes": [
            "Content-type: multipart/form-data"
          ],
          "parameters": [
            {
              "field": "description",
              "file": "file"
            }
          ],
          "responses": {
            "200": {
              "message": "OK"
            },
            "400": {
              "message": "Malformed username"
            },            
            "400": {
              "message": "File exceeds max size"
            },            
            "400": {
              "message": "Unexpected field key"
            },
            "401": {
              "message": "Unauthorized user"
            },
            "500": {
                "message": "Internal error"
            }
          }
        }
      }
    },

    "definitions": {
      "Order": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "petId": {
            "type": "integer",
            "format": "int64"
          },
          "quantity": {
            "type": "integer",
            "format": "int32"
          },
          "shipDate": {
            "type": "string",
            "format": "date-time"
          },
          "status": {
            "type": "string",
            "description": "Order Status",
            "enum": [
              "placed",
              "approved",
              "delivered"
            ]
          },
          "complete": {
            "type": "boolean",
            "default": false
          }
        },
        "xml": {
          "name": "Order"
        }
      },

      "User": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "name": {
            "type": "string"
          },
          "created_at": {
            "type": "string"
          }
        }
      },
      "Post": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "user_id": {
            "type": "integer",
            "format": "int64"
          },
          "description": {
              "type": "string"
          },
          "img_path": {
            "type": "string"
          },
          "created_at": {
            "type": "string"
          }
        }
      },
      "Session": {
        "type": "object",
        "properties": {
          "sid": {
            "type": "string"
          },
          "sess": {
            "type": "json"
          },
          "expire": {
            "type": "string"
          },
          "user_id": {
            "type": "integer",
            "format": "int64"
          }
        }
      }
    },
    "components": {
        "securitySchemes": {
            "cookieAuth": {
                "type": "apiKey",
                "in": "cookie",
                "name": "connect.sid"
            }
        }
    }
  }